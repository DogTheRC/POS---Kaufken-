{% extends "base.html" %}

{% block extra_head %}
<!-- Bloque para estilos adicionales -->
{% load static %}
    <link rel="stylesheet" href="{% static 'css/form.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet"></link> 
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    {% endblock %}

{% block content %}
<h2 class="form_h2">{{ title }}</h2>

<form class="formulario" method="post" autocomplete="off" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}  <!-- Aquí se renderiza el formulario principal -->

    {% if formset %}
        <h3>Fechas del Producto</h3>
        {{ formset.management_form }}  <!-- Esto es necesario para el manejo de formsets -->
        {% for form in formset %}
            <div>
                {{ form.as_p }}  <!-- Renderiza cada formulario del formset -->
            </div>
        {% endfor %}
    {% endif %}

    <button type="submit" class="button_formulario">
        <i class="fas fa-plus-circle"></i> {{ title }}
    </button>
</form>

{% if form.errors or formset.errors %}
    <script>
        var errors = '';

        // Errores del formulario principal (ProductoForm)
        {% for field in form %}
            {% for error in field.errors %}
                errors += '<p class="error-message">' + '{{ error }}' + '</p>';
            {% endfor %}
        {% endfor %}

        {% if formset %}
            {% for form in formset %}
                {% for field in form %}
                    {% for error in field.errors %}
                        errors += '<p class="error-message">' + '{{ error }}' + '</p>';
                    {% endfor %}
                {% endfor %}

                <!-- Errores globales del formset -->
                {% for error in form.non_field_errors %}
                    errors += '<p class="error-message">' + '{{ error }}' + '</p>';
                {% endfor %}
            {% endfor %}
        {% endif %}

        // Si hay errores, mostrar SweetAlert
        if (errors.trim()) {
            Swal.fire({
                icon: 'error',
                title: 'Ha ocurrido un error',
                html: errors, // Usamos 'html' para permitir el formato HTML
                confirmButtonText: 'Aceptar'
            });
        }
    </script>
{% endif %}

<script>
    $('form').on('submit', function(e){
        e.preventDefault();
        var parameters = $(this).serializeArray();
        console.log(parameters);
     $.ajax({
            url: '{% url 'productos:crearProductos' %}',
            type: 'POST',
            data: { id: 19 },
            dataType: 'JSON'  // Asegúrate de que esto esté correcto
        }).done(function (data) {
            console.log(data);
        }).fail(function (data) {
            alert("Error al realizar la solicitud.");
        }).always(function () {
            alert("La solicitud se ha completado.");
        });

    });
</script>

{% endblock content %}
